{% extends "base.html" %}

{% block title %}–ü–∞–Ω–µ–ª—å –≤–æ–¥–∏—Ç–µ–ª—è - Transfer Service{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-3">
        <div class="list-group">
            <a href="#" class="list-group-item list-group-item-action active" data-section="available-orders">
                <i class="bi bi-car-front"></i> –î–æ—Å—Ç—É–ø–Ω—ã–µ –∑–∞–∫–∞–∑—ã
            </a>
            <a href="#" class="list-group-item list-group-item-action" data-section="my-orders">
                <i class="bi bi-list"></i> –ú–æ–∏ –∑–∞–∫–∞–∑—ã
            </a>
            <a href="#" class="list-group-item list-group-item-action" data-section="stats">
                <i class="bi bi-graph-up"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            </a>
            <a href="#" class="list-group-item list-group-item-action" data-section="profile">
                <i class="bi bi-person"></i> –ü—Ä–æ—Ñ–∏–ª—å
            </a>
            <a href="#" class="list-group-item list-group-item-action" data-section="cars">
                <i class="bi bi-truck"></i> –ú–æ–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏
            </a>
            <a href="/driver/upload-documents" class="list-group-item list-group-item-action list-group-item-warning">
                <i class="bi bi-cloud-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã
            </a>
        </div>
    </div>
    <div class="col-md-9">
        <!-- Status Banner -->
        <div id="verification-banner" class="alert mb-3" style="display: none;">
            <i class="bi bi-info-circle"></i> <span id="verification-message"></span>
        </div>

        <!-- Available Orders Section -->
        <div id="available-orders" class="section">
            <div class="card">
                <div class="card-header">
                    <h5>–î–æ—Å—Ç—É–ø–Ω—ã–µ –∑–∞–∫–∞–∑—ã</h5>
                </div>
                <div class="card-body">
                    <div id="availableOrdersList">
                        <p class="text-muted">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- My Orders Section -->
        <div id="my-orders" class="section" style="display: none;">
            <div class="card">
                <div class="card-header">
                    <h5>–ú–æ–∏ –∑–∞–∫–∞–∑—ã</h5>
                </div>
                <div class="card-body">
                    <div id="myOrdersList">
                        <p class="text-muted">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Section -->
        <div id="stats" class="section" style="display: none;">
            <div class="card">
                <div class="card-header">
                    <h5>–ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-info" id="verificationStatus"></div>
                    <div class="row" id="statsContent">
                        <div class="col-md-4 mb-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h3 id="totalTrips">0</h3>
                                    <p class="text-muted">–í—Å–µ–≥–æ –ø–æ–µ–∑–¥–æ–∫</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h3 id="completedTrips">0</h3>
                                    <p class="text-muted">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h3 id="totalEarnings">0 ‚ÇΩ</h3>
                                    <p class="text-muted">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h3 id="rating">0.0</h3>
                                    <p class="text-muted">–†–µ–π—Ç–∏–Ω–≥</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Section -->
        <div id="profile" class="section" style="display: none;">
            <div class="card">
                <div class="card-header">
                    <h5>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h5>
                </div>
                <div class="card-body">
                    <form id="profileForm">
                        <div class="mb-3">
                            <label for="phone" class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                            <input type="tel" class="form-control" id="phone" name="phone" required>
                        </div>
                        <div class="mb-3">
                            <label for="experience_years" class="form-label">–û–ø—ã—Ç –≤–æ–∂–¥–µ–Ω–∏—è (–ª–µ—Ç)</label>
                            <input type="number" class="form-control" id="experience_years" name="experience_years" min="0" max="50" required>
                        </div>
                        <div class="mb-3">
                            <label for="bio" class="form-label">–û —Å–µ–±–µ</label>
                            <textarea class="form-control" id="bio" name="bio" rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Cars Section -->
        <div id="cars" class="section" style="display: none;">
            <div class="card">
                <div class="card-header">
                    <h5>–ú–æ–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏</h5>
                </div>
                <div class="card-body">
                    <button class="btn btn-success mb-3" onclick="showAddCarForm()">
                        <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å
                    </button>

                    <div id="carsList"></div>

                    <!-- Add Car Form (hidden by default) -->
                    <div id="addCarForm" style="display: none;">
                        <h6 class="mt-4">–î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å</h6>
                        <form id="carForm">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="make" class="form-label">–ú–∞—Ä–∫–∞</label>
                                    <input type="text" class="form-control" id="make" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="model" class="form-label">–ú–æ–¥–µ–ª—å</label>
                                    <input type="text" class="form-control" id="model" required>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="year" class="form-label">–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞</label>
                                    <input type="number" class="form-control" id="year" min="1900" max="2024" required>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="color" class="form-label">–¶–≤–µ—Ç</label>
                                    <input type="text" class="form-control" id="color" required>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="license_plate" class="form-label">–ì–æ—Å–Ω–æ–º–µ—Ä</label>
                                    <input type="text" class="form-control" id="license_plate" required>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="capacity" class="form-label">–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å (—á–µ–ª)</label>
                                    <input type="number" class="form-control" id="capacity" min="1" max="20" required>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="form-check mt-4">
                                        <input class="form-check-input" type="checkbox" id="has_air_conditioning" checked>
                                        <label class="form-check-label" for="has_air_conditioning">
                                            –ö–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="form-check mt-4">
                                        <input class="form-check-input" type="checkbox" id="has_wifi">
                                        <label class="form-check-label" for="has_wifi">
                                            Wi-Fi
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            <button type="button" class="btn btn-secondary" onclick="hideAddCarForm()">–û—Ç–º–µ–Ω–∞</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –∏–∑ cookie
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
        function getAuthHeaders() {
            const token = getCookie('access_token');
            return {
                'Authorization': token
            };
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        checkVerificationStatus();

        // Section navigation
        const sections = document.querySelectorAll('.section');
        const navLinks = document.querySelectorAll('.list-group-item');

        navLinks.forEach(link => {
            link.addEventListener('click', function (e) {
                // –ù–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–ª–∏–∫–∏ –ø–æ —Å—Å—ã–ª–∫–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
                if (this.getAttribute('href') === '/driver/upload-documents') {
                    return;
                }
                e.preventDefault();

                const sectionId = this.dataset.section;

                sections.forEach(section => {
                    section.style.display = 'none';
                });

                if (sectionId) {
                    document.getElementById(sectionId).style.display = 'block';
                }

                navLinks.forEach(l => l.classList.remove('active'));
                this.classList.add('active');

                // Load data
                if (sectionId === 'available-orders') loadAvailableOrders();
                if (sectionId === 'my-orders') loadMyOrders();
                if (sectionId === 'stats') loadStats();
                if (sectionId === 'profile') loadProfile();
                if (sectionId === 'cars') loadCars();
            });
        });

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
        async function checkVerificationStatus() {
            try {
                const response = await fetch('/api/drivers/profile', {
                    headers: getAuthHeaders()
                });

                if (response.status === 401) {
                    window.location.href = '/login';
                    return;
                }

                if (!response.ok) {
                    throw new Error('Failed to load profile');
                }

                const data = await response.json();

                const banner = document.getElementById('verification-banner');
                const message = document.getElementById('verification-message');

                if (data.profile && data.profile.documents_status) {
                    const status = data.profile.documents_status;

                    if (status === 'pending') {
                        banner.className = 'alert alert-warning';
                        message.innerHTML = '‚è≥ –í–∞—à–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ. –û–∂–∏–¥–∞–π—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.';
                        banner.style.display = 'block';
                    } else if (status === 'approved') {
                        banner.className = 'alert alert-success';
                        message.innerHTML = '‚úì –í–∞—à –∞–∫–∫–∞—É–Ω—Ç –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω! –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–∫–∞–∑—ã.';
                        banner.style.display = 'block';
                    } else if (status === 'rejected') {
                        banner.className = 'alert alert-danger';
                        message.innerHTML = '‚úó –í–∞—à–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã –æ—Ç–∫–ª–æ–Ω–µ–Ω—ã. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ –Ω–æ–≤—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã.';
                        banner.style.display = 'block';
                    } else {
                        banner.className = 'alert alert-info';
                        message.innerHTML = 'üìã –ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞.';
                        banner.style.display = 'block';
                    }
                }
            } catch (error) {
                console.error('Error checking verification status:', error);
            }
        }

        // Load available orders
        async function loadAvailableOrders() {
            try {
                const response = await fetch('/api/drivers/available-orders', {
                    headers: getAuthHeaders()
                });

                if (response.status === 401) {
                    window.location.href = '/login';
                    return;
                }

                if (response.status === 403) {
                    document.getElementById('availableOrdersList').innerHTML =
                        '<div class="alert alert-warning">–í–∞—à –∞–∫–∫–∞—É–Ω—Ç –µ—â–µ –Ω–µ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω. –î–æ–∂–¥–∏—Ç–µ—Å—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.</div>';
                    return;
                }

                if (!response.ok) {
                    throw new Error('Failed to load orders');
                }

                const orders = await response.json();
                displayOrders(orders, 'availableOrdersList', true);
            } catch (error) {
                document.getElementById('availableOrdersList').innerHTML =
                    '<div class="alert alert-danger">–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∑–∞–∫–∞–∑–æ–≤</div>';
            }
        }

        // Load my orders
        async function loadMyOrders() {
            try {
                const response = await fetch('/api/orders/driver/my-orders', {
                    headers: getAuthHeaders()
                });

                if (response.status === 401) {
                    window.location.href = '/login';
                    return;
                }

                if (!response.ok) {
                    throw new Error('Failed to load orders');
                }
                const orders = await response.json();
                displayOrders(orders, 'myOrdersList', false);
            } catch (error) {
                document.getElementById('myOrdersList').innerHTML =
                    '<div class="alert alert-danger">–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∑–∞–∫–∞–∑–æ–≤</div>';
            }
        }

        // Display orders
        function displayOrders(orders, elementId, showAccept) {
            const container = document.getElementById(elementId);
            if (!orders || orders.length === 0) {
                container.innerHTML = '<p class="text-muted">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</p>';
                return;
            }

            let html = '<div class="list-group">';
            orders.forEach(order => {
                const statusClass = {
                    'pending': 'warning',
                    'accepted': 'info',
                    'completed': 'success',
                    'cancelled': 'danger'
                }[order.status] || 'secondary';

                html += `
                <div class="list-group-item">
                    <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1">${order.pickup_location} ‚Üí ${order.dropoff_location}</h6>
                        <small class="text-${statusClass}">${order.status}</small>
                    </div>
                    <p class="mb-1">–ü–∞—Å—Å–∞–∂–∏—Ä–æ–≤: ${order.passengers_count}, –ë–∞–≥–∞–∂: ${order.luggage_count}</p>
                    <p class="mb-1">–¶–µ–Ω–∞: ${order.client_price} ‚ÇΩ</p>
                    <small>${new Date(order.pickup_time).toLocaleString()}</small>
                    ${showAccept && order.status === 'pending' ?
                        `<button class="btn btn-sm btn-success mt-2" onclick="acceptOrder(${order.id})">–ü—Ä–∏–Ω—è—Ç—å –∑–∞–∫–∞–∑</button>` : ''}
                </div>
            `;
            });
            html += '</div>';
            container.innerHTML = html;
        }

        // Load stats
        async function loadStats() {
            try {
                const response = await fetch('/api/drivers/stats', {
                    headers: getAuthHeaders()
                });

                if (response.status === 401) {
                    window.location.href = '/login';
                    return;
                }

                if (!response.ok) {
                    throw new Error('Failed to load stats');
                }
                const stats = await response.json();

                document.getElementById('totalTrips').textContent = stats.total_trips || 0;
                document.getElementById('completedTrips').textContent = stats.completed_trips || 0;
                document.getElementById('totalEarnings').textContent = (stats.total_earnings || 0) + ' ‚ÇΩ';
                document.getElementById('rating').textContent = (stats.rating || 0).toFixed(1);

                const verificationStatus = document.getElementById('verificationStatus');
                if (stats.verification_status === 'approved') {
                    verificationStatus.className = 'alert alert-success';
                    verificationStatus.textContent = '‚úì –í–∞—à –∞–∫–∫–∞—É–Ω—Ç –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω';
                } else if (stats.verification_status === 'pending') {
                    verificationStatus.className = 'alert alert-warning';
                    verificationStatus.textContent = '‚è≥ –î–æ–∫—É–º–µ–Ω—Ç—ã –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ';
                } else if (stats.verification_status === 'rejected') {
                    verificationStatus.className = 'alert alert-danger';
                    verificationStatus.textContent = '‚úó –î–æ–∫—É–º–µ–Ω—Ç—ã –æ—Ç–∫–ª–æ–Ω–µ–Ω—ã. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –Ω–æ–≤—ã–µ.';
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Load profile
        async function loadProfile() {
            try {
                const response = await fetch('/api/drivers/profile', {
                    headers: getAuthHeaders()
                });

                if (response.status === 401) {
                    window.location.href = '/login';
                    return;
                }

                if (!response.ok) {
                    throw new Error('Failed to load profile');
                }
                const data = await response.json();

                if (data.profile) {
                    document.getElementById('phone').value = data.profile.phone || '';
                    document.getElementById('experience_years').value = data.profile.experience_years || 0;
                    document.getElementById('bio').value = data.profile.bio || '';
                }
            } catch (error) {
                console.error('Error loading profile:', error);
            }
        }

        // Load cars
        async function loadCars() {
            try {
                const response = await fetch('/api/drivers/profile', {
                    headers: getAuthHeaders()
                });

                if (response.status === 401) {
                    window.location.href = '/login';
                    return;
                }

                if (!response.ok) {
                    throw new Error('Failed to load cars');
                }
                const data = await response.json();

                const carsList = document.getElementById('carsList');
                if (!data.cars || data.cars.length === 0) {
                    carsList.innerHTML = '<p class="text-muted">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π</p>';
                    return;
                }

                let html = '<div class="list-group">';
                data.cars.forEach(car => {
                    html += `
                    <div class="list-group-item">
                        <h6>${car.make} ${car.model} (${car.year})</h6>
                        <p>–¶–≤–µ—Ç: ${car.color}, –ì–æ—Å–Ω–æ–º–µ—Ä: ${car.license_plate}</p>
                        <p>–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: ${car.capacity} —á–µ–ª.</p>
                        <p>${car.has_air_conditioning ? '‚úì –ö–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä' : '‚úó –ö–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä'} | ${car.has_wifi ? '‚úì Wi-Fi' : '‚úó Wi-Fi'}</p>
                    </div>
                `;
                });
                html += '</div>';
                carsList.innerHTML = html;
            } catch (error) {
                console.error('Error loading cars:', error);
            }
        }

        // Save profile
        document.getElementById('profileForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const formData = new FormData(this);
            try {
                const response = await fetch('/api/drivers/profile/update', {
                    method: 'POST',
                    headers: {
                        'Authorization': getCookie('access_token')
                    },
                    body: formData
                });

                if (response.status === 401) {
                    window.location.href = '/login';
                    return;
                }

                if (response.ok) {
                    alert('–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω');
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è');
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è');
            }
        });

        // Add car form submission
        document.getElementById('carForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const formData = new FormData();
            formData.append('make', document.getElementById('make').value);
            formData.append('model', document.getElementById('model').value);
            formData.append('year', document.getElementById('year').value);
            formData.append('color', document.getElementById('color').value);
            formData.append('license_plate', document.getElementById('license_plate').value);
            formData.append('capacity', document.getElementById('capacity').value);
            formData.append('has_air_conditioning', document.getElementById('has_air_conditioning').checked);
            formData.append('has_wifi', document.getElementById('has_wifi').checked);

            try {
                const response = await fetch('/api/drivers/cars/add', {
                    method: 'POST',
                    headers: {
                        'Authorization': getCookie('access_token')
                    },
                    body: formData
                });

                if (response.status === 401) {
                    window.location.href = '/login';
                    return;
                }

                if (response.ok) {
                    alert('–ê–≤—Ç–æ–º–æ–±–∏–ª—å –¥–æ–±–∞–≤–ª–µ–Ω');
                    hideAddCarForm();
                    this.reset();
                    loadCars();
                } else {
                    const error = await response.json();
                    alert('–û—à–∏–±–∫–∞: ' + (error.detail || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª—è');
            }
        });
    });

    // Accept order
    async function acceptOrder(orderId) {
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }

        try {
            const response = await fetch(`/api/drivers/orders/${orderId}/accept`, {
                method: 'POST',
                headers: {
                    'Authorization': getCookie('access_token')
                }
            });

            if (response.status === 401) {
                window.location.href = '/login';
                return;
            }

            if (response.ok) {
                alert('–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç!');
                loadAvailableOrders();
                loadMyOrders();
            } else {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ –∑–∞–∫–∞–∑–∞');
            }
        } catch (error) {
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ –∑–∞–∫–∞–∑–∞');
        }
    }

    // Show/hide add car form
    function showAddCarForm() {
        document.getElementById('addCarForm').style.display = 'block';
    }

    function hideAddCarForm() {
        document.getElementById('addCarForm').style.display = 'none';
    }
</script>
{% endblock %}